import { Directive, ElementRef, HostListener, Input, Output, EventEmitter } from '@angular/core';
import { fromEvent } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { isLeftButton, getEvent } from '../common/utils';
import * as ɵngcc0 from '@angular/core';
export class ResizableDirective {
    constructor(element) {
        this.resizeBegin = new EventEmitter();
        this.resizing = new EventEmitter();
        this.resizeEnd = new EventEmitter();
        this.element = element.nativeElement;
    }
    ngAfterViewInit() {
        if (this.south) {
            this.createHandle('resize-handle-s');
        }
        if (this.east) {
            this.createHandle('resize-handle-e');
        }
        if (this.southEast) {
            this.createHandle('resize-handle-se');
        }
        if (this.southWest) {
            this.createHandle('resize-handle-sw');
        }
        if (this.west) {
            this.createHandle('resize-handle-w');
        }
        if (this.northWest) {
            this.createHandle('resize-handle-nw');
        }
        if (this.north) {
            this.createHandle('resize-handle-n');
        }
        if (this.northEast) {
            this.createHandle('resize-handle-ne');
        }
        const computedStyle = window.getComputedStyle(this.element);
        this.minWidth = parseFloat(computedStyle.minWidth);
        this.maxWidth = parseFloat(computedStyle.maxWidth);
        this.minHeight = parseFloat(computedStyle.minHeight);
        this.maxHeight = parseFloat(computedStyle.maxHeight);
    }
    ngOnDestroy() {
        this.destroySubscription();
    }
    onMousedown(event) {
        if (!isLeftButton(event)) {
            return;
        }
        const classList = (event.target).classList;
        const isSouth = classList.contains('resize-handle-s');
        const isEast = classList.contains('resize-handle-e');
        const isSouthEast = classList.contains('resize-handle-se');
        const isSouthWest = classList.contains('resize-handle-sw');
        const isWest = classList.contains('resize-handle-w');
        const isNorthWest = classList.contains('resize-handle-nw');
        const isNorth = classList.contains('resize-handle-n');
        const isNorthEast = classList.contains('resize-handle-ne');
        const evt = getEvent(event);
        const width = this.element.clientWidth;
        const height = this.element.clientHeight;
        const left = this.element.offsetLeft;
        const top = this.element.offsetTop;
        const screenX = evt.screenX;
        const screenY = evt.screenY;
        const isTouchEvent = event.type.startsWith('touch');
        const moveEvent = isTouchEvent ? 'touchmove' : 'mousemove';
        const upEvent = isTouchEvent ? 'touchend' : 'mouseup';
        if (isSouth || isEast || isSouthEast || isSouthWest || isWest || isNorthWest || isNorth || isNorthEast) {
            this.initResize(event, isSouth, isEast, isSouthEast, isSouthWest, isWest, isNorthWest, isNorth, isNorthEast);
            const mouseup = fromEvent(document, upEvent);
            this.subscription = mouseup
                .subscribe((ev) => this.onMouseup(ev));
            const mouseMoveSub = fromEvent(document, moveEvent)
                .pipe(takeUntil(mouseup))
                .subscribe((e) => this.move(e, width, height, top, left, screenX, screenY));
            this.subscription.add(mouseMoveSub);
        }
    }
    move(event, width, height, top, left, screenX, screenY) {
        const evt = getEvent(event);
        const movementX = evt.screenX - screenX;
        const movementY = evt.screenY - screenY;
        this.newWidth = width - (this.resizingSW || this.resizingW || this.resizingNW ? movementX : -movementX);
        this.newHeight = height - (this.resizingNW || this.resizingN || this.resizingNE ? movementY : -movementY);
        this.newLeft = left + movementX;
        this.newTop = top + movementY;
        this.resizeWidth(evt);
        this.resizeHeight(evt);
    }
    onMouseup(event) {
        this.endResize(event);
        this.destroySubscription();
    }
    destroySubscription() {
        if (this.subscription) {
            this.subscription.unsubscribe();
            this.subscription = undefined;
        }
    }
    createHandle(edgeClass) {
        const node = document.createElement('span');
        node.className = edgeClass;
        this.element.appendChild(node);
    }
    initResize(event, isSouth, isEast, isSouthEast, isSouthWest, isWest, isNorthWest, isNorth, isNorthEast) {
        if (isSouth) {
            this.resizingS = true;
        }
        if (isEast) {
            this.resizingE = true;
        }
        if (isSouthEast) {
            this.resizingSE = true;
        }
        if (isSouthWest) {
            this.resizingSW = true;
        }
        if (isWest) {
            this.resizingW = true;
        }
        if (isNorthWest) {
            this.resizingNW = true;
        }
        if (isNorth) {
            this.resizingN = true;
        }
        if (isNorthEast) {
            this.resizingNE = true;
        }
        this.element.classList.add('resizing');
        this.newWidth = this.element.clientWidth;
        this.newHeight = this.element.clientHeight;
        this.newLeft = this.element.offsetLeft;
        this.newTop = this.element.offsetTop;
        event.stopPropagation();
        this.resizeBegin.emit();
    }
    endResize(event) {
        this.resizingS = false;
        this.resizingE = false;
        this.resizingSE = false;
        this.resizingSW = false;
        this.resizingW = false;
        this.resizingNW = false;
        this.resizingN = false;
        this.resizingNE = false;
        this.element.classList.remove('resizing');
        this.resizeEnd.emit({ event: getEvent(event), width: this.newWidth, height: this.newHeight });
    }
    resizeWidth(event) {
        const overMinWidth = !this.minWidth || this.newWidth >= this.minWidth;
        const underMaxWidth = !this.maxWidth || this.newWidth <= this.maxWidth;
        if (this.resizingSE || this.resizingE || this.resizingNE) {
            if (overMinWidth && underMaxWidth) {
                if (!this.ghost) {
                    this.element.style.width = `${this.newWidth}px`;
                }
            }
        }
        if (this.resizingSW || this.resizingW || this.resizingNW) {
            if (overMinWidth && underMaxWidth) {
                this.element.style.left = `${this.newLeft}px`;
                this.element.style.width = `${this.newWidth}px`;
            }
        }
        this.resizing.emit({ event, width: this.newWidth, height: this.newHeight, direction: 'horizontal' });
    }
    resizeHeight(event) {
        const overMinHeight = !this.minHeight || this.newHeight >= this.minHeight;
        const underMaxHeight = !this.maxHeight || this.newHeight <= this.maxHeight;
        if (this.resizingSE || this.resizingS || this.resizingSW) {
            if (overMinHeight && underMaxHeight) {
                if (!this.ghost) {
                    this.element.style.height = `${this.newHeight}px`;
                }
            }
        }
        if (this.resizingNW || this.resizingN || this.resizingNE) {
            if (overMinHeight && underMaxHeight) {
                if (!this.ghost) {
                    this.element.style.top = `${this.newTop}px`;
                    this.element.style.height = `${this.newHeight}px`;
                }
            }
        }
        this.resizing.emit({ event, width: this.newWidth, height: this.newHeight, direction: 'vertical' });
    }
}
ResizableDirective.ɵfac = function ResizableDirective_Factory(t) { return new (t || ResizableDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
ResizableDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: ResizableDirective, selectors: [["", "appResizable", ""]], hostBindings: function ResizableDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("mousedown", function ResizableDirective_mousedown_HostBindingHandler($event) { return ctx.onMousedown($event); })("touchstart", function ResizableDirective_touchstart_HostBindingHandler($event) { return ctx.onMousedown($event); });
    } }, inputs: { south: "south", east: "east", southEast: "southEast", ghost: "ghost", southWest: "southWest", west: "west", northWest: "northWest", north: "north", northEast: "northEast" }, outputs: { resizeBegin: "resizeBegin", resizing: "resizing", resizeEnd: "resizeEnd" } });
ResizableDirective.ctorParameters = () => [
    { type: ElementRef }
];
ResizableDirective.propDecorators = {
    south: [{ type: Input }],
    east: [{ type: Input }],
    southEast: [{ type: Input }],
    ghost: [{ type: Input }],
    southWest: [{ type: Input }],
    west: [{ type: Input }],
    northWest: [{ type: Input }],
    north: [{ type: Input }],
    northEast: [{ type: Input }],
    resizeBegin: [{ type: Output }],
    resizing: [{ type: Output }],
    resizeEnd: [{ type: Output }],
    onMousedown: [{ type: HostListener, args: ['mousedown', ['$event'],] }, { type: HostListener, args: ['touchstart', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ResizableDirective, [{
        type: Directive,
        args: [{
                selector: '[appResizable]'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }]; }, { resizeBegin: [{
            type: Output
        }], resizing: [{
            type: Output
        }], resizeEnd: [{
            type: Output
        }], onMousedown: [{
            type: HostListener,
            args: ['mousedown', ['$event']]
        }, {
            type: HostListener,
            args: ['touchstart', ['$event']]
        }], south: [{
            type: Input
        }], east: [{
            type: Input
        }], southEast: [{
            type: Input
        }], ghost: [{
            type: Input
        }], southWest: [{
            type: Input
        }], west: [{
            type: Input
        }], northWest: [{
            type: Input
        }], north: [{
            type: Input
        }], northEast: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzaXphYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vcHJvamVjdHMvbmctbW9kYWwtbGliL3NyYy9saWIvcmVzaXphYmxlL3Jlc2l6YWJsZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUNqRSxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQWdCLFNBQVMsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7QUFNekQsTUFBTSxPQUFPLGtCQUFrQjtBQUFHLElBb0NoQyxZQUFZLE9BQW1CO0FBQ2pDLFFBekJZLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDaEUsUUFBWSxhQUFRLEdBQWlDLElBQUksWUFBWSxFQUFFLENBQUM7QUFDeEUsUUFBWSxjQUFTLEdBQWlDLElBQUksWUFBWSxFQUFFLENBQUM7QUFDekUsUUFzQkksSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDO0FBQ3pDLElBQUUsQ0FBQztBQUNILElBQ0UsZUFBZTtBQUFLLFFBQ2xCLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtBQUNwQixZQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUMzQyxTQUFLO0FBQ0wsUUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7QUFDbkIsWUFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDM0MsU0FBSztBQUNMLFFBQUksSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO0FBQ3hCLFlBQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFB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Q1gsTUFBTTtBQUFLLDBCQThEWCxZQUFZLFNBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDLGNBQ3BDLFlBQVksU0FBQyxZQUFZLEVBQUUsQ0FBQyxRQUFRLENBQUM7QUFDcEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCBmcm9tRXZlbnQgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGlzTGVmdEJ1dHRvbiwgZ2V0RXZlbnQgfSBmcm9tICcuLi9jb21tb24vdXRpbHMnO1xuaW1wb3J0IHsgUmVzaXphYmxlRXZlbnQgfSBmcm9tICcuL3R5cGVzJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2FwcFJlc2l6YWJsZV0nXG59KVxuZXhwb3J0IGNsYXNzIFJlc2l6YWJsZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgQElucHV0KCkgc291dGg6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGVhc3Q6IGJvb2xlYW47XG4gIEBJbnB1dCgpIHNvdXRoRWFzdDogYm9vbGVhbjtcbiAgQElucHV0KCkgZ2hvc3Q6IGJvb2xlYW47XG4gIEBJbnB1dCgpIHNvdXRoV2VzdDogYm9vbGVhbjtcbiAgQElucHV0KCkgd2VzdDogYm9vbGVhbjtcbiAgQElucHV0KCkgbm9ydGhXZXN0OiBib29sZWFuO1xuICBASW5wdXQoKSBub3J0aDogYm9vbGVhbjtcbiAgQElucHV0KCkgbm9ydGhFYXN0OiBib29sZWFuO1xuXG4gIEBPdXRwdXQoKSByZXNpemVCZWdpbjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSByZXNpemluZzogRXZlbnRFbWl0dGVyPFJlc2l6YWJsZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIHJlc2l6ZUVuZDogRXZlbnRFbWl0dGVyPFJlc2l6YWJsZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBlbGVtZW50OiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBuZXdXaWR0aDogbnVtYmVyO1xuICBwcml2YXRlIG5ld0hlaWdodDogbnVtYmVyO1xuICBwcml2YXRlIG5ld0xlZnQ6IG51bWJlcjtcbiAgcHJpdmF0ZSBuZXdUb3A6IG51bWJlcjtcbiAgcHJpdmF0ZSByZXNpemluZ1M6IGJvb2xlYW47IC8vIHNvdXRoXG4gIHByaXZhdGUgcmVzaXppbmdFOiBib29sZWFuOyAvLyBlYXN0XG4gIHByaXZhdGUgcmVzaXppbmdTRTogYm9vbGVhbjsgLy8gc291dGgtZWFzdFxuICBwcml2YXRlIHJlc2l6aW5nU1c6IGJvb2xlYW47XG4gIHByaXZhdGUgcmVzaXppbmdXOiBib29sZWFuO1xuICBwcml2YXRlIHJlc2l6aW5nTlc6IGJvb2xlYW47XG4gIHByaXZhdGUgcmVzaXppbmdOOiBib29sZWFuO1xuICBwcml2YXRlIHJlc2l6aW5nTkU6IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBtaW5XaWR0aDogbnVtYmVyO1xuICBwcml2YXRlIG1heFdpZHRoOiBudW1iZXI7XG4gIHByaXZhdGUgbWluSGVpZ2h0OiBudW1iZXI7XG4gIHByaXZhdGUgbWF4SGVpZ2h0OiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoZWxlbWVudDogRWxlbWVudFJlZikge1xuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zb3V0aCkge1xuICAgICAgdGhpcy5jcmVhdGVIYW5kbGUoJ3Jlc2l6ZS1oYW5kbGUtcycpO1xuICAgIH1cbiAgICBpZiAodGhpcy5lYXN0KSB7XG4gICAgICB0aGlzLmNyZWF0ZUhhbmRsZSgncmVzaXplLWhhbmRsZS1lJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLnNvdXRoRWFzdCkge1xuICAgICAgdGhpcy5jcmVhdGVIYW5kbGUoJ3Jlc2l6ZS1oYW5kbGUtc2UnKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc291dGhXZXN0KSB7XG4gICAgICB0aGlzLmNyZWF0ZUhhbmRsZSgncmVzaXplLWhhbmRsZS1zdycpO1xuICAgIH1cbiAgICBpZiAodGhpcy53ZXN0KSB7XG4gICAgICB0aGlzLmNyZWF0ZUhhbmRsZSgncmVzaXplLWhhbmRsZS13Jyk7XG4gICAgfVxuICAgIGlmICh0aGlzLm5vcnRoV2VzdCkge1xuICAgICAgdGhpcy5jcmVhdGVIYW5kbGUoJ3Jlc2l6ZS1oYW5kbGUtbncnKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubm9ydGgpIHtcbiAgICAgIHRoaXMuY3JlYXRlSGFuZGxlKCdyZXNpemUtaGFuZGxlLW4nKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubm9ydGhFYXN0KSB7XG4gICAgICB0aGlzLmNyZWF0ZUhhbmRsZSgncmVzaXplLWhhbmRsZS1uZScpO1xuICAgIH1cbiAgICBjb25zdCBjb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50KTtcbiAgICB0aGlzLm1pbldpZHRoID0gcGFyc2VGbG9hdChjb21wdXRlZFN0eWxlLm1pbldpZHRoKTtcbiAgICB0aGlzLm1heFdpZHRoID0gcGFyc2VGbG9hdChjb21wdXRlZFN0eWxlLm1heFdpZHRoKTtcbiAgICB0aGlzLm1pbkhlaWdodCA9IHBhcnNlRmxvYXQoY29tcHV0ZWRTdHlsZS5taW5IZWlnaHQpO1xuICAgIHRoaXMubWF4SGVpZ2h0ID0gcGFyc2VGbG9hdChjb21wdXRlZFN0eWxlLm1heEhlaWdodCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmRlc3Ryb3lTdWJzY3JpcHRpb24oKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlZG93bicsIFsnJGV2ZW50J10pXG4gIEBIb3N0TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBbJyRldmVudCddKVxuICBvbk1vdXNlZG93bihldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIWlzTGVmdEJ1dHRvbihldmVudCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY2xhc3NMaXN0ID0gKChldmVudC50YXJnZXQpIGFzIEhUTUxFbGVtZW50KS5jbGFzc0xpc3Q7XG4gICAgY29uc3QgaXNTb3V0aCA9IGNsYXNzTGlzdC5jb250YWlucygncmVzaXplLWhhbmRsZS1zJyk7XG4gICAgY29uc3QgaXNFYXN0ID0gY2xhc3NMaXN0LmNvbnRhaW5zKCdyZXNpemUtaGFuZGxlLWUnKTtcbiAgICBjb25zdCBpc1NvdXRoRWFzdCA9IGNsYXNzTGlzdC5jb250YWlucygncmVzaXplLWhhbmRsZS1zZScpO1xuICAgIGNvbnN0IGlzU291dGhXZXN0ID0gY2xhc3NMaXN0LmNvbnRhaW5zKCdyZXNpemUtaGFuZGxlLXN3Jyk7XG4gICAgY29uc3QgaXNXZXN0ID0gY2xhc3NMaXN0LmNvbnRhaW5zKCdyZXNpemUtaGFuZGxlLXcnKTtcbiAgICBjb25zdCBpc05vcnRoV2VzdCA9IGNsYXNzTGlzdC5jb250YWlucygncmVzaXplLWhhbmRsZS1udycpO1xuICAgIGNvbnN0IGlzTm9ydGggPSBjbGFzc0xpc3QuY29udGFpbnMoJ3Jlc2l6ZS1oYW5kbGUtbicpO1xuICAgIGNvbnN0IGlzTm9ydGhFYXN0ID0gY2xhc3NMaXN0LmNvbnRhaW5zKCdyZXNpemUtaGFuZGxlLW5lJyk7XG5cbiAgICBjb25zdCBldnQgPSBnZXRFdmVudChldmVudCk7XG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLmVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICBjb25zdCBsZWZ0ID0gdGhpcy5lbGVtZW50Lm9mZnNldExlZnQ7XG4gICAgY29uc3QgdG9wID0gdGhpcy5lbGVtZW50Lm9mZnNldFRvcDtcbiAgICBjb25zdCBzY3JlZW5YID0gZXZ0LnNjcmVlblg7XG4gICAgY29uc3Qgc2NyZWVuWSA9IGV2dC5zY3JlZW5ZO1xuXG4gICAgY29uc3QgaXNUb3VjaEV2ZW50ID0gZXZlbnQudHlwZS5zdGFydHNXaXRoKCd0b3VjaCcpO1xuICAgIGNvbnN0IG1vdmVFdmVudCA9IGlzVG91Y2hFdmVudCA/ICd0b3VjaG1vdmUnIDogJ21vdXNlbW92ZSc7XG4gICAgY29uc3QgdXBFdmVudCA9IGlzVG91Y2hFdmVudCA/ICd0b3VjaGVuZCcgOiAnbW91c2V1cCc7XG5cbiAgICBpZiAoaXNTb3V0aCB8fCBpc0Vhc3QgfHwgaXNTb3V0aEVhc3QgfHwgaXNTb3V0aFdlc3QgfHwgaXNXZXN0IHx8IGlzTm9ydGhXZXN0IHx8IGlzTm9ydGggfHwgaXNOb3J0aEVhc3QpIHtcbiAgICAgIHRoaXMuaW5pdFJlc2l6ZShldmVudCwgaXNTb3V0aCwgaXNFYXN0LCBpc1NvdXRoRWFzdCwgaXNTb3V0aFdlc3QsIGlzV2VzdCwgaXNOb3J0aFdlc3QsIGlzTm9ydGgsIGlzTm9ydGhFYXN0KTtcblxuICAgICAgY29uc3QgbW91c2V1cCA9IGZyb21FdmVudChkb2N1bWVudCwgdXBFdmVudCk7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IG1vdXNldXBcbiAgICAgICAgLnN1YnNjcmliZSgoZXY6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSA9PiB0aGlzLm9uTW91c2V1cChldikpO1xuXG4gICAgICBjb25zdCBtb3VzZU1vdmVTdWIgPSBmcm9tRXZlbnQoZG9jdW1lbnQsIG1vdmVFdmVudClcbiAgICAgICAgLnBpcGUodGFrZVVudGlsKG1vdXNldXApKVxuICAgICAgICAuc3Vic2NyaWJlKChlOiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCkgPT4gdGhpcy5tb3ZlKGUsIHdpZHRoLCBoZWlnaHQsIHRvcCwgbGVmdCwgc2NyZWVuWCwgc2NyZWVuWSkpO1xuXG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbi5hZGQobW91c2VNb3ZlU3ViKTtcbiAgICB9XG4gIH1cblxuICBtb3ZlKGV2ZW50OiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIsIHNjcmVlblg6IG51bWJlciwgc2NyZWVuWTogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgZXZ0ID0gZ2V0RXZlbnQoZXZlbnQpO1xuICAgIGNvbnN0IG1vdmVtZW50WCA9IGV2dC5zY3JlZW5YIC0gc2NyZWVuWDtcbiAgICBjb25zdCBtb3ZlbWVudFkgPSBldnQuc2NyZWVuWSAtIHNjcmVlblk7XG5cbiAgICB0aGlzLm5ld1dpZHRoID0gd2lkdGggLSAodGhpcy5yZXNpemluZ1NXIHx8IHRoaXMucmVzaXppbmdXIHx8IHRoaXMucmVzaXppbmdOVyA/IG1vdmVtZW50WCA6IC1tb3ZlbWVudFgpO1xuICAgIHRoaXMubmV3SGVpZ2h0ID0gaGVpZ2h0IC0gKHRoaXMucmVzaXppbmdOVyB8fCB0aGlzLnJlc2l6aW5nTiB8fCB0aGlzLnJlc2l6aW5nTkUgPyBtb3ZlbWVudFkgOiAtbW92ZW1lbnRZKTtcbiAgICB0aGlzLm5ld0xlZnQgPSBsZWZ0ICsgbW92ZW1lbnRYO1xuICAgIHRoaXMubmV3VG9wID0gdG9wICsgbW92ZW1lbnRZO1xuXG4gICAgdGhpcy5yZXNpemVXaWR0aChldnQpO1xuICAgIHRoaXMucmVzaXplSGVpZ2h0KGV2dCk7XG4gIH1cblxuICBvbk1vdXNldXAoZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5lbmRSZXNpemUoZXZlbnQpO1xuICAgIHRoaXMuZGVzdHJveVN1YnNjcmlwdGlvbigpO1xuICB9XG5cbiAgcHJpdmF0ZSBkZXN0cm95U3Vic2NyaXB0aW9uKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlSGFuZGxlKGVkZ2VDbGFzczogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3Qgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICBub2RlLmNsYXNzTmFtZSA9IGVkZ2VDbGFzcztcbiAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG4gIH1cblxuICBpbml0UmVzaXplKGV2ZW50OiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCxcbiAgICBpc1NvdXRoOiBib29sZWFuLFxuICAgIGlzRWFzdDogYm9vbGVhbixcbiAgICBpc1NvdXRoRWFzdDogYm9vbGVhbixcbiAgICBpc1NvdXRoV2VzdDogYm9vbGVhbixcbiAgICBpc1dlc3Q6IGJvb2xlYW4sXG4gICAgaXNOb3J0aFdlc3Q6IGJvb2xlYW4sXG4gICAgaXNOb3J0aDogYm9vbGVhbixcbiAgICBpc05vcnRoRWFzdDogYm9vbGVhbikge1xuICAgIGlmIChpc1NvdXRoKSB7XG4gICAgICB0aGlzLnJlc2l6aW5nUyA9IHRydWU7XG4gICAgfVxuICAgIGlmIChpc0Vhc3QpIHtcbiAgICAgIHRoaXMucmVzaXppbmdFID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGlzU291dGhFYXN0KSB7XG4gICAgICB0aGlzLnJlc2l6aW5nU0UgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoaXNTb3V0aFdlc3QpIHtcbiAgICAgIHRoaXMucmVzaXppbmdTVyA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKGlzV2VzdCkge1xuICAgICAgdGhpcy5yZXNpemluZ1cgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChpc05vcnRoV2VzdCkge1xuICAgICAgdGhpcy5yZXNpemluZ05XID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoaXNOb3J0aCkge1xuICAgICAgdGhpcy5yZXNpemluZ04gPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChpc05vcnRoRWFzdCkge1xuICAgICAgdGhpcy5yZXNpemluZ05FID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3Jlc2l6aW5nJyk7XG4gICAgdGhpcy5uZXdXaWR0aCA9IHRoaXMuZWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICB0aGlzLm5ld0hlaWdodCA9IHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gICAgdGhpcy5uZXdMZWZ0ID0gdGhpcy5lbGVtZW50Lm9mZnNldExlZnQ7XG4gICAgdGhpcy5uZXdUb3AgPSB0aGlzLmVsZW1lbnQub2Zmc2V0VG9wO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMucmVzaXplQmVnaW4uZW1pdCgpO1xuICB9XG5cbiAgZW5kUmVzaXplKGV2ZW50OiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCk6IHZvaWQge1xuICAgIHRoaXMucmVzaXppbmdTID0gZmFsc2U7XG4gICAgdGhpcy5yZXNpemluZ0UgPSBmYWxzZTtcbiAgICB0aGlzLnJlc2l6aW5nU0UgPSBmYWxzZTtcbiAgICB0aGlzLnJlc2l6aW5nU1cgPSBmYWxzZTtcbiAgICB0aGlzLnJlc2l6aW5nVyA9IGZhbHNlO1xuICAgIHRoaXMucmVzaXppbmdOVyA9IGZhbHNlO1xuICAgIHRoaXMucmVzaXppbmdOID0gZmFsc2U7XG4gICAgdGhpcy5yZXNpemluZ05FID0gZmFsc2U7XG4gICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Jlc2l6aW5nJyk7XG4gICAgdGhpcy5yZXNpemVFbmQuZW1pdCh7IGV2ZW50OiBnZXRFdmVudChldmVudCksIHdpZHRoOiB0aGlzLm5ld1dpZHRoLCBoZWlnaHQ6IHRoaXMubmV3SGVpZ2h0IH0pO1xuICB9XG5cbiAgcmVzaXplV2lkdGgoZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaCk6IHZvaWQge1xuICAgIGNvbnN0IG92ZXJNaW5XaWR0aCA9ICF0aGlzLm1pbldpZHRoIHx8IHRoaXMubmV3V2lkdGggPj0gdGhpcy5taW5XaWR0aDtcbiAgICBjb25zdCB1bmRlck1heFdpZHRoID0gIXRoaXMubWF4V2lkdGggfHwgdGhpcy5uZXdXaWR0aCA8PSB0aGlzLm1heFdpZHRoO1xuXG4gICAgaWYgKHRoaXMucmVzaXppbmdTRSB8fCB0aGlzLnJlc2l6aW5nRSB8fCB0aGlzLnJlc2l6aW5nTkUpIHtcbiAgICAgIGlmIChvdmVyTWluV2lkdGggJiYgdW5kZXJNYXhXaWR0aCkge1xuICAgICAgICBpZiAoIXRoaXMuZ2hvc3QpIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSBgJHt0aGlzLm5ld1dpZHRofXB4YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5yZXNpemluZ1NXIHx8IHRoaXMucmVzaXppbmdXIHx8IHRoaXMucmVzaXppbmdOVykge1xuICAgICAgaWYgKG92ZXJNaW5XaWR0aCAmJiB1bmRlck1heFdpZHRoKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5sZWZ0ID0gYCR7dGhpcy5uZXdMZWZ0fXB4YDtcbiAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gYCR7dGhpcy5uZXdXaWR0aH1weGA7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMucmVzaXppbmcuZW1pdCh7IGV2ZW50LCB3aWR0aDogdGhpcy5uZXdXaWR0aCwgaGVpZ2h0OiB0aGlzLm5ld0hlaWdodCwgZGlyZWN0aW9uOiAnaG9yaXpvbnRhbCcgfSk7XG5cbiAgfVxuXG4gIHJlc2l6ZUhlaWdodChldmVudDogTW91c2VFdmVudCB8IFRvdWNoKTogdm9pZCB7XG4gICAgY29uc3Qgb3Zlck1pbkhlaWdodCA9ICF0aGlzLm1pbkhlaWdodCB8fCB0aGlzLm5ld0hlaWdodCA+PSB0aGlzLm1pbkhlaWdodDtcbiAgICBjb25zdCB1bmRlck1heEhlaWdodCA9ICF0aGlzLm1heEhlaWdodCB8fCB0aGlzLm5ld0hlaWdodCA8PSB0aGlzLm1heEhlaWdodDtcbiAgICBpZiAodGhpcy5yZXNpemluZ1NFIHx8IHRoaXMucmVzaXppbmdTIHx8IHRoaXMucmVzaXppbmdTVykge1xuICAgICAgaWYgKG92ZXJNaW5IZWlnaHQgJiYgdW5kZXJNYXhIZWlnaHQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmdob3N0KSB7XG4gICAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke3RoaXMubmV3SGVpZ2h0fXB4YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnJlc2l6aW5nTlcgfHwgdGhpcy5yZXNpemluZ04gfHwgdGhpcy5yZXNpemluZ05FKSB7XG4gICAgICBpZiAob3Zlck1pbkhlaWdodCAmJiB1bmRlck1heEhlaWdodCkge1xuICAgICAgICBpZiAoIXRoaXMuZ2hvc3QpIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0gYCR7dGhpcy5uZXdUb3B9cHhgO1xuICAgICAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBgJHt0aGlzLm5ld0hlaWdodH1weGA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5yZXNpemluZy5lbWl0KHsgZXZlbnQsIHdpZHRoOiB0aGlzLm5ld1dpZHRoLCBoZWlnaHQ6IHRoaXMubmV3SGVpZ2h0LCBkaXJlY3Rpb246ICd2ZXJ0aWNhbCcgfSk7XG4gIH1cblxufVxuIl19